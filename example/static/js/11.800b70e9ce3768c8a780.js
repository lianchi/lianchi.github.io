webpackJsonp([11],{"9JPR":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("mvHQ"),i=function(t){return t&&t.__esModule?t:{default:t}}(a),n=o("lDdF"),r=o("5LfB"),l=o("9E5R"),s=o("RUjS"),u=o("0nCa");o("E4LH");e.default={data:function(){return{filters:{hostId:null,userId:null,datetimerange:null,eventType:null,orgId:null},importForm:{},importFormVisible:!1,notUploaded:!0,uploadFileList:[],uploadDone:"<span style='color: #13ce66'>"+this.$t("ofa.audit.uploadSuccess")+"</span>",uploadFail:"<span style='color: #ff4949'>"+this.$t("ofa.audit.uploadTip")+"</span>",eventTypeOptions:[],orgOptions:[],datePickerOptions:{shortcuts:(0,u.dateShortcuts)(this)},auditLogData:[],auditLogLoading:!1,currentPage:1,pageSize:10,pageSizes:[10,25,50],totalElements:0}},methods:{currentChange:function(t){this.currentPage=t,this.getData()},sizeChange:function(t){this.pageSize=t,this.getData()},formatTime:function(t,e,o){return(0,u.formatStamp)(o)},formatOrg:function(t,e,o){var a=this.orgOptions.find(function(t){return t.id==o});return void 0==a?"空":a.displayName},getEventTypes:function(){var t=this;l.ofaRequest.eventType.get().then(function(e){t.eventTypeOptions=e.data.content})},getOrgs:function(){var t=this;r.rtaRequest.getOrgs().then(function(e){t.orgOptions=e.data})},importClick:function(){this.importFormVisible=!0},handleUploadChange:function(t,e){this.uploadFileList=e.slice(-1)},handleUploadSuccess:function(t,e,o){this.$message({message:"上传成功",type:"success"}),this.notUploaded=!1},handleUploadError:function(t,e,o){this.$message({message:"上传失败",type:"warning"}),this.notUploaded=!0},importSubmit:function(){this.$refs.uploadFile.submit()},importCancel:function(){var t=this;this.$refs.uploadFile.abort(),this.$refs.uploadFile.clearFiles(),this.$refs.importForm.resetFields(),this.importFormVisible=!1,setTimeout(function(){t.notUploaded=!0},1e3)},importDone:function(){this.importCancel(),this.getData()},exportClick:function(){var t=this.auditLogData;t=t.map(function(t){return(0,i.default)(t)+"\n"}),t[t.length-1]=t[t.length-1].replace(/\n$/g,"");var e=new Blob(t,{type:"text/plain"}),o=new Date,a="审计日志-Page"+this.currentPage+"-"+u.formatDatetime.format(o,"yyyyMMddhhmm")+".txt";(0,n.saveAs)(e,a)},getData:function(){var t=this,e=this.filters,o=e.userId,a=e.hostId;if(o&&o.length>32||a&&a.length>32)return void(0,s.alertMessage)(this,this.$t("validate.lessThan"));this.auditLogLoading=!0;var i="",n="";this.filters.datetimerange&&(i=Number(this.filters.datetimerange[0]),n=Number(this.filters.datetimerange[1]));var r={subjectId:this.filters.userId,hostId:this.filters.hostId,startTime:i,endTime:n,event:this.filters.eventType,orgId:this.filters.orgId,pageSize:this.pageSize,pageNum:this.currentPage-1};l.ofaRequest.getLogs(r).then(function(e){t.auditLogData=e.data.content,t.totalElements=e.data.totalElements,t.auditLogLoading=!1}).catch(function(){t.auditLogLoading=!1})}},mounted:function(){this.getOrgs(),this.getEventTypes(),this.getData()}}},KXE3:function(t,e,o){"use strict";var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("section",[o("div",{staticClass:"toolbar"},[o("el-input",{staticStyle:{width:"140px"},attrs:{placeholder:this.$tc("ofa.audit.userId",1)},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.getData(e)}},model:{value:t.filters.userId,callback:function(e){t.$set(t.filters,"userId","string"==typeof e?e.trim():e)},expression:"filters.userId"}}),t._v(" "),o("el-input",{staticStyle:{"margin-left":"10px",width:"140px"},attrs:{placeholder:this.$tc("ofa.audit.hostId",1)},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.getData(e)}},model:{value:t.filters.hostId,callback:function(e){t.$set(t.filters,"hostId","string"==typeof e?e.trim():e)},expression:"filters.hostId"}}),t._v(" "),o("el-date-picker",{staticStyle:{"margin-left":"10px",width:"350px"},attrs:{editable:!1,type:"datetimerange","start-placeholder":this.$t("date.startDate"),"end-placeholder":this.$t("date.endDate"),align:"left","unlink-panels":"","picker-options":t.datePickerOptions},model:{value:t.filters.datetimerange,callback:function(e){t.$set(t.filters,"datetimerange",e)},expression:"filters.datetimerange"}}),t._v(" "),o("el-select",{staticStyle:{"margin-left":"10px",width:"180px"},attrs:{filterable:"",clearable:"",placeholder:this.$t("ofa.table.eventName")},model:{value:t.filters.eventType,callback:function(e){t.$set(t.filters,"eventType",e)},expression:"filters.eventType"}},t._l(t.eventTypeOptions,function(t){return o("el-option",{key:t.event,attrs:{label:t.event,value:t.event}})})),t._v(" "),o("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.getData}},[t._v(t._s(t.$t("button.search")))]),t._v(" "),o("el-button-group",{staticStyle:{"margin-left":"20px"}},[o("el-button",{attrs:{type:"primary",icon:"el-icon-upload"},on:{click:t.importClick}},[t._v(t._s(t.$t("button.import")))]),t._v(" "),o("el-button",{attrs:{type:"primary",icon:"el-icon-download",disabled:0===this.auditLogData.length},on:{click:t.exportClick}},[t._v(t._s(t.$t("button.export")))])],1)],1),t._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.auditLogLoading,expression:"auditLogLoading"}],ref:"logTable",staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{data:t.auditLogData,stripe:"","show-overflow-tooltip":!0,"highlight-current-row":!0,"tooltip-effect":"dark","max-height":"680"}},[o("el-table-column",{attrs:{type:"index",width:"60"}}),t._v(" "),o("el-table-column",{attrs:{prop:"subjectId",label:this.$t("ofa.table.userId"),"min-width":"60",sortable:"","show-overflow-tooltip":""}}),t._v(" "),o("el-table-column",{attrs:{prop:"subject",label:this.$t("ofa.table.subject"),"min-width":"60",sortable:"","show-overflow-tooltip":""}}),t._v(" "),o("el-table-column",{attrs:{prop:"hostId",label:this.$t("ofa.table.hostId"),"min-width":"100",sortable:"","show-overflow-tooltip":""}}),t._v(" "),o("el-table-column",{attrs:{prop:"sourceIp",label:this.$t("ofa.table.hostIP"),"min-width":"100",sortable:"","show-overflow-tooltip":""}}),t._v(" "),o("el-table-column",{attrs:{prop:"generateTime",label:this.$t("ofa.table.eventTime"),"min-width":"100",sortable:"",formatter:t.formatTime,"show-overflow-tooltip":""}}),t._v(" "),o("el-table-column",{attrs:{prop:"event",label:this.$t("ofa.table.eventName"),"min-width":"80",sortable:"","show-overflow-tooltip":""}}),t._v(" "),o("el-table-column",{attrs:{prop:"from",label:this.$t("ofa.table.from"),"min-width":"100",sortable:"","show-overflow-tooltip":""}}),t._v(" "),o("el-table-column",{attrs:{prop:"sourceLog",label:this.$t("ofa.table.sourceLog"),"min-width":"140","show-overflow-tooltip":""}})],1),t._v(" "),o("div",{staticClass:"common-toolbar-footer"},[o("el-pagination",{staticStyle:{float:"right"},attrs:{"current-page":t.currentPage,"page-sizes":t.pageSizes,"page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.totalElements},on:{"current-change":t.currentChange,"size-change":t.sizeChange}})],1),t._v(" "),o("el-dialog",{attrs:{title:this.$t("ofa.audit.logImport"),width:"30%",visible:t.importFormVisible,"close-on-click-modal":!1,"before-close":t.importCancel},on:{"update:visible":function(e){t.importFormVisible=e}}},[o("el-form",{ref:"importForm",attrs:{model:t.importForm,"label-width":"80px"}},[o("el-form-item",{attrs:{label:this.$t("ofa.audit.logFile")+": ",prop:"file"}},[o("el-upload",{ref:"uploadFile",staticClass:"upload-demo",attrs:{action:"http://127.0.0.1:7083/audit/auditLogImport/","with-credentials":!0,"on-change":t.handleUploadChange,"on-success":t.handleUploadSuccess,"on-error":t.handleUploadError,"auto-upload":!0,accept:".txt","file-list":t.uploadFileList}},[o("el-button",{attrs:{slot:"trigger",type:"primary"},slot:"trigger"},[t._v(t._s(t.$t("ofa.audit.chooseUpload")))]),t._v(" "),o("span",{staticClass:"el-upload__tip",staticStyle:{"margin-left":"40px"},attrs:{slot:"tip"},domProps:{innerHTML:t._s(t.notUploaded?t.uploadFail:t.uploadDone)},slot:"tip"})],1)],1)],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{disabled:!t.notUploaded},on:{click:t.importCancel}},[t._v(t._s(t.$t("button.cancel")))]),t._v(" "),o("el-button",{attrs:{disabled:t.notUploaded,type:"primary"},on:{click:t.importDone}},[t._v(t._s(t.$t("button.confirm")))])],1)],1)],1)},i=[],n={render:a,staticRenderFns:i};e.a=n},LGuY:function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},XaSv:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("9JPR"),i=o.n(a),n=o("KXE3"),r=o("VU/8"),l=r(i.a,n.a,!1,null,null,null);e.default=l.exports},lDdF:function(t,e,o){var a,i=i||function(t){"use strict";if(!(void 0===t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,o=function(){return t.URL||t.webkitURL||t},a=e.createElementNS("http://www.w3.org/1999/xhtml","a"),i="download"in a,n=function(t){var e=new MouseEvent("click");t.dispatchEvent(e)},r=/constructor/i.test(t.HTMLElement)||t.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent),s=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},u=function(t){var e=function(){"string"==typeof t?o().revokeObjectURL(t):t.remove()};setTimeout(e,4e4)},d=function(t,e,o){e=[].concat(e);for(var a=e.length;a--;){var i=t["on"+e[a]];if("function"==typeof i)try{i.call(t,o||t)}catch(t){s(t)}}},c=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},p=function(e,s,p){p||(e=c(e));var f,h=this,m=e.type,g="application/octet-stream"===m,v=function(){d(h,"writestart progress write writeend".split(" "))};if(h.readyState=h.INIT,i)return f=o().createObjectURL(e),void setTimeout(function(){a.href=f,a.download=s,n(a),v(),u(f),h.readyState=h.DONE});!function(){if((l||g&&r)&&t.FileReader){var a=new FileReader;return a.onloadend=function(){var e=l?a.result:a.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,h.readyState=h.DONE,v()},a.readAsDataURL(e),void(h.readyState=h.INIT)}if(f||(f=o().createObjectURL(e)),g)t.location.href=f;else{t.open(f,"_blank")||(t.location.href=f)}h.readyState=h.DONE,v(),u(f)}()},f=p.prototype,h=function(t,e,o){return new p(t,e||t.name||"download",o)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,o){return e=e||t.name||"download",o||(t=c(t)),navigator.msSaveOrOpenBlob(t,e)}:(f.abort=function(){},f.readyState=f.INIT=0,f.WRITING=1,f.DONE=2,f.error=f.onwritestart=f.onprogress=f.onwrite=f.onabort=f.onerror=f.onwriteend=null,h)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);void 0!==t&&t.exports?t.exports.saveAs=i:null!==o("LGuY")&&null!==o("nErl")&&void 0!==(a=function(){return i}.call(e,o,e,t))&&(t.exports=a)},nErl:function(t,e){(function(e){t.exports=e}).call(e,{})}});